/*
 * Copyright (C) 2025 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package {
    default_applicable_licenses: ["Android-Apache-2.0"],
}

test_package {
    name: "platform_tests",
    tests: [
        "ActivityManagerPerfTests",
        "ActivityManagerPerfTestsStubApp1",
        "ActivityManagerPerfTestsStubApp2",
        "ActivityManagerPerfTestsStubApp3",
        "ActivityManagerPerfTestsTestApp",
        "AdServicesScenarioTests",
        "AndroidAutomotiveDialScenarioTests",
        "AndroidTVJankTests",
        "AndroidXComposeStartupApp",
        "ApiDemos",
        "AppCompatibilityTest",
        "AppLaunch",
        "AppTransitionTests",
        "BackgroundDexOptServiceIntegrationTests",
        "BandwidthEnforcementTest",
        "BandwidthTests",
        "benchmarks",
        "BootHelperApp",
        "BusinessCard",
        "CalendarTests",
        "CellBroadcastReceiverTests",
        "ConnectivityUIDTest",
        "CtsCameraTestCases",
        "CuttlefishRilTests",
        "CuttlefishWifiTests",
        "Development",
        "DeviceHealthChecks",
        "DialerJankTests",
        "DynamicCodeLoggerIntegrationTests",
        "FacebookAppsScenarioTests",
        "FlickerTestApp",
        "FrameworkPerf",
        "FrameworkPermissionTests",
        "FrameworksCoreSystemPropertiesTests",
        "FrameworksCoreTests",
        "FrameworksMockingCoreTests",
        "FrameworksPrivacyLibraryTests",
        "FrameworksSaxTests",
        "FrameworksServicesTests",
        "FrameworksUtilTests",
        "FrameworkTestRunnerTests",
        "ImageProcessing",
        "JankMicroBenchmarkTests",
        "LauncherIconsApp",
        "mediaframeworktest",
        "MemoryUsage",
        "OverviewFunctionalTests",
        "PerformanceAppTest",
        "PerformanceLaunch",
        "PermissionFunctionalTests",
        "PermissionTestAppMV1",
        "PermissionUtils",
        "PlatformCommonScenarioTests",
        "PlatformComposeSceneTransitionLayoutDemo",
        "PMC",
        "PowerPerfTest",
        "SdkSandboxClient",
        "SdkSandboxCodeProvider",
        "SdkSandboxMediateeProvider",
        "SdkSandboxPerfScenarioTests",
        "SdkSandboxWebViewProvider",
        "SettingsUITests",
        "SimpleTestApp",
        "sl4a",
        "SmokeTest",
        "SmokeTestApp",
        "StubIME",
        "UbSystemUiJankTests",
        "UbWebViewJankTests",
        "UiBench",
        "UiBenchJankTests",
        "UiBenchJankTestsWear",
        "UiBenchMicrobenchmark",
        "uwb_snippet",
        "wifi_aware_snippet_new",
        "wifi_direct_mobly_snippet",
        "WifiStrengthScannerUtil",
    ],
    device_first_tests: [
        "memory_per_process-avg_rss_and_swap.textproto",
        "long_trace_binder_config.textproto",
        "long_trace_config.textproto",
        "total_runtime_per_slice_for_systemui_process.textproto",
        "total_runtime_per_thread_for_systemui_process.textproto",
        "trace_config.textproto",
        "trace_config_boot_time.textproto",
        "trace_config_boot_time_stop.textproto",
        "trace_config_detailed.textproto",
        "trace_config_detailed_heapdump.textproto",
        "trace_config_experimental.textproto",
        "trace_config_multi_user_cuj_tests.textproto",
        "trace_config_post_boot.textproto",
        "trace_config_power.textproto",
    ] + select(soong_config_variable("perf", "board_perfsetup_script"), {
        any: ["perf-setup"],
        default: [],
    }),
    device_both_tests: [
        "camera_client_test",
        "camera_metadata_tests",
        "flatland",
        "hwuimacro",
        "mmapPerf",
        "xaVideoDecoderCapabilities",
    ],
    host_tests: [
        "perfetto_trace_processor_shell",
        "root-canal",
    ],
    tests_if_exist_common: [
        "AndroidAutoScenarioTests",
        "BiometricsMicrobenchmark",
        "BootHelperAppInternal",
        "CameraPerformanceTests",
        "CastSignAPITest",
        "ClickEnableAdb",
        "ClockworkNotificationTests",
        "CollectorsHelperTest",
        "DialogDismissalUtil",
        "DisplayMicrobenchTests",
        "DrmMediaTests",
        "ExternalStorageFunctionalTests",
        "FitnessPowerTests",
        "GCBench",
        "GeppettoClockwork",
        "GoogleAppsTestUtils",
        "GoogleCameraTests",
        "LauncherFunctionalTests",
        "LocationSimulator",
        "LockscreenFunctionalTests",
        "MarkTest",
        "MediaBenchmark",
        "MediaDrmAPITest",
        "MessagingTests",
        "MetaTestPerformance",
        "MetaTestPerformanceInner",
        "ModemDiagnosticSystemTest",
        "NetworkSimulation",
        "OtaEndToEndTestApp",
        "OtaFunctionalTests",
        "OtaJankTests",
        "OtaMigrationTests",
        "PageCycler",
        "PlacesPowerTests",
        "PlatformScenarioTests",
        "Power",
        "power-tests",
        "PowerCarrierTestsApp",
        "PowerOrchestrator",
        "PowerUtil",
        "SetGoogleAccount",
        "SettingsFunctionalTests",
        "SystemAppJankTests",
        "SystemUpdatesUtil",
        "SystemUtils",
    ],
    tests_if_exist_device_both: select(soong_config_variable("ci_tests", "uses_widevine_tests"), {
        true: [
            "base64_test",
            "buffer_reader_test",
            "cdm_coverage_test",
            "cdm_engine_metrics_decorator_unittest",
            "cdm_engine_test",
            "cdm_session_unittest",
            "cdm_usage_table_unittest",
            "certificate_provisioning_unittest",
            "core_integration_test",
            "counter_metric_unittest",
            "crypto_session_unittest",
            "device_files_unittest",
            "distribution_unittest",
            "duration_use_case_test",
            "event_metric_unittest",
            "file_store_unittest",
            "file_utils_unittest",
            "generic_crypto_unittest",
            "hal_metrics_adapter_unittest",
            "http_socket_test",
            "initialization_data_unittest",
            "keybox_ota_test",
            "libwvdrmdrmplugin_hal_test",
            "libwvdrmengine_hal_test",
            "libwvdrmmediacrypto_hal_test",
            "license_keys_unittest",
            "license_unittest",
            "metrics_collections_unittest",
            "odk_test",
            "oemcrypto_test",
            "okp_fallback_policy_test",
            "ota_keybox_provisioner_test",
            "policy_engine_constraints_unittest",
            "policy_engine_unittest",
            "policy_integration_test",
            "request_license_test",
            "rw_lock_test",
            "service_certificate_unittest",
            "system_id_extractor_unittest",
            "timer_unittest",
            "value_metric_unittest",
            "wv_cdm_metrics_test",
            "wv_plugin_test",
        ],
        default: [],
    }),

    dists: [
        {
            targets: ["platform_tests"],
            prepend_artifact_with_product: true,
            dest: "tests-FILE_NAME_TAG_PLACEHOLDER.zip",
        },
        {
            targets: ["platform_tests"],
            prepend_artifact_with_product: true,
            dest: "platform_tests-symbols-FILE_NAME_TAG_PLACEHOLDER.zip",
            tag: ".symbols",
        },
        {
            targets: ["platform_tests"],
            prepend_artifact_with_product: true,
            dest: "platform_tests-symbols-mapping-FILE_NAME_TAG_PLACEHOLDER.textproto",
            tag: ".elf_mapping",
        },
    ],
}

test_package {
    name: "continuous_native_tests_soong",
    device_first_tests: [
        "adbd_test",
        "keystore2_test",
        "lmkd_unit_test",
    ] + select(soong_config_variable("perf", "board_perfsetup_script"), {
        any: ["perf-setup"],
        default: [],
    }),

    device_both_tests: [
        "aaudio_test_mmap_path",
        "android_logger_test_src_lib",
        "android_logger_test_tests_config_log_level",
        "android_logger_test_tests_default_init",
        "android_logger_test_tests_multiple_init",
        "anyhow_test_src_lib",
        "anyhow_test_tests_test_autotrait",
        "anyhow_test_tests_test_boxed",
        "anyhow_test_tests_test_chain",
        "anyhow_test_tests_test_context",
        "anyhow_test_tests_test_convert",
        "anyhow_test_tests_test_downcast",
        "anyhow_test_tests_test_fmt",
        "anyhow_test_tests_test_macros",
        "anyhow_test_tests_test_repr",
        "anyhow_test_tests_test_source",
        "audio_health_tests",
        "bionic-unit-tests",
        "bionic-unit-tests-static",
        "bluetooth_test_common",
        "bootstat_tests",
        "boringssl_crypto_test",
        "boringssl_ssl_test",
        "bsdiff_unittest",
        "bugreportz_test",
        "bytes_test_tests_test_buf",
        "bytes_test_tests_test_buf_mut",
        "bytes_test_tests_test_bytes",
        "bytes_test_tests_test_bytes_odd_alloc",
        "bytes_test_tests_test_bytes_vec_alloc",
        "bytes_test_tests_test_chain",
        "bytes_test_tests_test_debug",
        "bytes_test_tests_test_iter",
        "bytes_test_tests_test_reader",
        "bytes_test_tests_test_take",
        "camera_client_test",
        "cesu8_test_src_lib",
        "clatd_test",
        "confirmationui_invocation_test",
        "debuggerd_test",
        "doh_ffi_test",
        "doh_unit_test",
        "dumpstate_test",
        "dumpstate_test_fixture",
        "dumpsys_test",
        "gpuservice_unittest",
        "gwp_asan_unittest",
        "hello_world_test",
        "hwui_unit_tests",
        "incident_helper_test",
        "incidentd_test",
        "inputflinger_tests",
        "installd_cache_test",
        "installd_dexopt_test",
        "installd_file_test",
        "installd_otapreopt_test",
        "installd_service_test",
        "installd_utils_test",
        "jni_test_src_lib",
        "keystore2_crypto_test_rust",
        "keystore2_selinux_test",
        "lazy_static_test_tests_test",
        "libandroidfw_tests",
        "libappfuse_test",
        "libbase_test",
        "libbinder_rs-internal_test",
        "libbpf_android_test",
        "libcutils_test",
        "libcutils_test_static",
        "libgui_test",
        "libhidl_test",
        "libinput_tests",
        "libjavacore-unit-tests",
        "liblog-unit-tests",
        "libminijail_unittest_gtest",
        "libnativehelper_tests",
        "libnetworkstats_test",
        "libnfc-nci-jni-tests",
        "libnfc-nci-tests",
        "libprocinfo_test",
        "librenderengine_test",
        "libtextclassifier_tests-tplus",
        "libtextclassifier_tests-sminus",
        "libsurfaceflinger_unittest",
        "libunwindstack_unit_test",
        "libuwb_core_tests",
        "libuwb_uci_jni_rust_tests",
        "libuwb_uci_packet_tests",
        "libuci_hal_android_tests",
        "libvintf_test",
        "linker-unit-tests",
        "logcat-unit-tests",
        "logd-unit-tests",
        "logger_device_unit_tests",
        "kernel-config-unit-tests",
        "malloc_debug_unit_tests",
        "memory_replay_tests",
        "memunreachable_test",
        "minadbd_test",
        "minikin_tests",
        "mj_system_unittest_gtest",
        "mj_util_unittest_gtest",
        "mtp_ffs_handle_test",
        "netd_integration_test",
        "netd_unit_test",
        "netdutils_test",
        "num-traits_test_src_lib",
        "num-traits_test_tests_cast",
        "perfetto_integrationtests",
        "posix_async_io_test",
        "prioritydumper_test",
        "puffin_unittest",
        "quiche_device_test_src_lib",
        "recovery_unit_test",
        "resolv_gold_test",
        "resolv_integration_test",
        "resolv_unit_test",
        "ring_test_src_lib",
        "ring_test_tests_aead_tests",
        "ring_test_tests_agreement_tests",
        "ring_test_tests_constant_time_tests",
        "ring_test_tests_digest_tests",
        "ring_test_tests_ecdsa_tests",
        "ring_test_tests_ed25519_tests",
        "ring_test_tests_hkdf_tests",
        "ring_test_tests_hmac_tests",
        "ring_test_tests_pbkdf2_tests",
        "ring_test_tests_quic_tests",
        "ring_test_tests_rand_tests",
        "ring_test_tests_rsa_tests",
        "ring_test_tests_signature_tests",
        "scrape_mmap_addr",
        "simpleperf_cpu_hotplug_test",
        "simpleperf_unit_test",
        "statsd_test",
        "syscall_filter_unittest_gtest",
        "time-unit-tests",
        "tokio_test_tests__require_full",
        "tokio_test_tests_buffered",
        "tokio_test_tests_io_async_fd",
        "tokio_test_tests_io_async_read",
        "tokio_test_tests_io_chain",
        "tokio_test_tests_io_copy",
        "tokio_test_tests_io_copy_bidirectional",
        "tokio_test_tests_io_driver",
        "tokio_test_tests_io_driver_drop",
        "tokio_test_tests_io_lines",
        "tokio_test_tests_io_mem_stream",
        "tokio_test_tests_io_read",
        "tokio_test_tests_io_read_buf",
        "tokio_test_tests_io_read_exact",
        "tokio_test_tests_io_read_line",
        "tokio_test_tests_io_read_to_end",
        "tokio_test_tests_io_read_to_string",
        "tokio_test_tests_io_read_until",
        "tokio_test_tests_io_split",
        "tokio_test_tests_io_take",
        "tokio_test_tests_io_write",
        "tokio_test_tests_io_write_all",
        "tokio_test_tests_io_write_buf",
        "tokio_test_tests_io_write_int",
        "tokio_test_tests_macros_join",
        "tokio_test_tests_macros_pin",
        "tokio_test_tests_macros_select",
        "tokio_test_tests_macros_test",
        "tokio_test_tests_macros_try_join",
        "tokio_test_tests_net_bind_resource",
        "tokio_test_tests_net_lookup_host",
        "tokio_test_tests_no_rt",
        "tokio_test_tests_process_kill_on_drop",
        "tokio_test_tests_rt_basic",
        "tokio_test_tests_rt_common",
        "tokio_test_tests_rt_threaded",
        "tokio_test_tests_sync_barrier",
        "tokio_test_tests_sync_broadcast",
        "tokio_test_tests_sync_errors",
        "tokio_test_tests_sync_mutex",
        "tokio_test_tests_sync_mutex_owned",
        "tokio_test_tests_sync_notify",
        "tokio_test_tests_sync_oneshot",
        "tokio_test_tests_sync_rwlock",
        "tokio_test_tests_sync_semaphore",
        "tokio_test_tests_sync_semaphore_owned",
        "tokio_test_tests_sync_watch",
        "tokio_test_tests_task_abort",
        "tokio_test_tests_task_blocking",
        "tokio_test_tests_task_local",
        "tokio_test_tests_task_local_set",
        "tokio_test_tests_tcp_accept",
        "tokio_test_tests_tcp_connect",
        "tokio_test_tests_tcp_echo",
        "tokio_test_tests_tcp_into_split",
        "tokio_test_tests_tcp_into_std",
        "tokio_test_tests_tcp_peek",
        "tokio_test_tests_tcp_shutdown",
        "tokio_test_tests_tcp_socket",
        "tokio_test_tests_tcp_split",
        "tokio_test_tests_time_rt",
        "tokio_test_tests_udp",
        "tokio_test_tests_uds_cred",
        "tokio_test_tests_uds_split",
        "tokio-test_test_tests_block_on",
        "tokio-test_test_tests_io",
        "tokio-test_test_tests_macros",
        "unicode-xid_test_src_lib",
        "update_engine_unittests",
        "url_test_src_lib",
        "url_test_tests_unit",
        "vintf_object_test",
        "wificond_unit_test",
        "ziparchive-tests",
        "GraphicBuffer_test",
        "NeuralNetworksTest_mt_static",
        "NeuralNetworksTest_operations",
        "NeuralNetworksTest_static",
        "NeuralNetworksTest_utils",
        "SurfaceFlinger_test",
    ] + select(soong_config_variable("ANDROID", "board_is_automotive"), {
        true: [
            "evsmanagerd_test",
            "libwatchdog_test",
        ],
        default: [],
    }),
    tests_if_exist_device_both: select(soong_config_variable("ci_tests", "uses_darwinn_tests"), {
        true: [
            "DarwiNNTest",
        ],
        default: [],
    }),
    dists: [
        {
            targets: ["continuous_native_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_tests-FILE_NAME_TAG_PLACEHOLDER.zip",
        },
        {
            targets: ["continuous_native_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_tests-symbols-FILE_NAME_TAG_PLACEHOLDER.zip",
            tag: ".symbols",
        },
        {
            targets: ["continuous_native_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_tests-symbols-mapping-FILE_NAME_TAG_PLACEHOLDER.textproto",
            tag: ".elf_mapping",
        },
    ],
}

test_package {
    name: "continuous_native_metric_tests_soong",
    device_first_tests: [
    ] + select(soong_config_variable("perf", "board_perfsetup_script"), {
        any: ["perf-setup"],
        default: [],
    }),

    device_both_tests: [
        "binderAddInts",
        "binderRpcBenchmark",
        "bionic-benchmarks",
        "binder_thread_stats",
        "hwuimacro",
        "hwuimicro",
        "inputflinger_benchmarks",
        "libandroidfw_benchmarks",
        "libhwbinder_benchmark",
        "libjavacore-benchmarks",
        "libgui_benchmarks",
        "libpowermanager_benchmarks",
        "libvibratorservice_benchmarks",
        "minikin_perftests",
        "mmapPerf",
        "netd_benchmark",
        "VibratorHalIntegrationBenchmark",
        "librenderengine_bench",
        "statsd_benchmark",
        "surfaceflinger_microbenchmarks",
    ],
    tests_if_exist_device_both: [
    ],

    dists: [
        {
            targets: ["continuous_native_metric_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_metric_tests-FILE_NAME_TAG_PLACEHOLDER.zip",
        },
        {
            targets: ["continuous_native_metric_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_metric_tests-symbols-FILE_NAME_TAG_PLACEHOLDER.zip",
            tag: ".symbols",
        },
        {
            targets: ["continuous_native_metric_tests"],
            prepend_artifact_with_product: true,
            dest: "continuous_native_metric_tests-symbols-mapping-FILE_NAME_TAG_PLACEHOLDER.textproto",
            tag: ".elf_mapping",
        },
    ],
}

test_package {
    name: "continuous_instrumentation_tests_soong",

    tests: [
        "HelloWorldTests",
        "BluetoothInstrumentationTests",
        "LongevityPlatformLibTests",
        "ManagedProvisioningTests",
        "FrameworksCoreTests",
        "FrameworksCoreGameManagerTests",
        "FrameworksMockingCoreTests",
        "BinderProxyCountingTestApp",
        "BinderProxyCountingTestService",
        "FrameworksNetTests",
        "FrameworksUiServicesTests",
        "FrameworksUiServicesNotificationTests",
        "FrameworksUiServicesZenTests",
        "BstatsTestApp",
        "FrameworksServicesTests",
        "FrameworksMockingServicesTests",
        "WmTests",
        "WmPerfTests",
        "DisplayServiceTests",
        "SuspendTestApp",
        "FrameworksUtilTests",
        "MtpServiceTests",
        "MtpTests",
        "DocumentsUITests",
        "ShellTests",
        "SystemUITests",
        "TvSystemUITests",
        "TestablesTests",
        "FrameworksWifiApiTests",
        "FrameworksWifiNonUpdatableApiTests",
        "FrameworksWifiTests",
        "FrameworksTelephonyTests",
        "ContactsProviderTests",
        "SettingsUnitTests",
        "TelecomUnitTests",
        "TraceurUiTests",
        "AndroidVCardTests",
        "PermissionFunctionalTests",
        "BlockedNumberProviderTest",
        "DownloadAppFunctionalTests",
        "DynamicCodeLoggerIntegrationTests",
        "UsbTests",
        "DownloadProviderTests",
        "EmergencyInfoUnitTests",
        "CalendarProviderTests",
        "SettingsLibTests",
        "RSTest",
        "PrintSpoolerOutOfProcessTests",
        "CellBroadcastReceiverUnitTests",
        "CellBroadcastServiceTests",
        "TelephonyProviderTests",
        "CarrierConfigTests",
        "TeleServiceTests",
        "PresencePollingTests",
        "ImsCommonTests",
        "SettingsProviderTest",
        "FrameworksPrivacyLibraryTests",
        "SettingsUITests",
        "SettingsPerfTests",
        "ExtServicesUnitTests-tplus",
        "ExtServicesUnitTests-sminus",
        "FrameworksNetSmokeTests",
        "FlickerLibTest",
        "WMShellUnitTests",
        "CarDeveloperOptionsUnitTests",
        "SpaPrivilegedLibTests",
        "SettingsSpaUnitTests",
        "SpaLibTests",
        "PermissionServiceMockingTests",
    ] + select(soong_config_variable("ci_tests", "uses_storage_manager_tests"), {
        any: ["StorageManagerUnitTests"],
        default: [],
    }),
    device_first_tests: [
        "trace_config_detailed.textproto",
    ] + select(soong_config_variable("perf", "board_perfsetup_script"), {
        any: ["perf-setup"],
        default: [],
    }),

    device_both_tests: [
    ],
    tests_if_exist_common: [
        "CarrierSetupTests",
        "DocumentsUIGoogleTests",
        "GenericBootstrappingArchitectureTests",
        "GoogleBluetoothInstrumentationTests",
        "GoogleCellBroadcastReceiverUnitTests",
        "ImsStackJavaTests",
        "Launcher3",
        "Launcher3Tests",
        "LauncherFunctionalTests",
        "MultiuserAppLaunchTests",
        "NexusLauncherDebug",
        "NexusLauncherOutOfProcTests",
        "NexusLauncherProguard",
        "NexusLauncherTests",
        "NexusLauncherImageTests",
        "NexusLauncherViewScreenshotTests",
        "PixelImsMediaJavaUnitTests",
        "PixelSatelliteServiceTests",
        "QualifiedNetworksServiceTests",
        "SettingsGoogleUnitTests",
        "SettingsFunctionalTests",
        "StorageManagerGoogleUnitTests",
        "SystemUIGoogleTests",
    ],
    tests_if_exist_device_both: [
    ],
    tests_if_exist_device_first: [
        "ImsStackNativeTests",
    ],
    host_tests: [
        "perfetto_trace_processor_shell",
    ],
    tests_if_exist_host: [
        "MultiuserHostsideIntegrationTests",
    ],

    dist: {
        targets: ["continuous_instrumentation_tests"],
        prepend_artifact_with_product: true,
        dest: "continuous_instrumentation_tests-FILE_NAME_TAG_PLACEHOLDER.zip",
    },
}
